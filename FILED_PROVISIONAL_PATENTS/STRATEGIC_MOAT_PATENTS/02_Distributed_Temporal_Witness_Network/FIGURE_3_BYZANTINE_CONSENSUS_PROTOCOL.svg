<svg viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1200" height="800" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2"/>
  
  <!-- Title -->
  <text x="600" y="30" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#212529">
    Figure 3: Byzantine Fault Tolerant Consensus Protocol
  </text>
  
  <!-- Main Area -->
  <rect x="50" y="60" width="1100" height="680" fill="#ffffff" stroke="#6c757d" stroke-width="2" rx="10"/>
  
  <!-- Phase 1: Initial Witness Response -->
  <g transform="translate(100, 100)">
    <rect x="0" y="0" width="250" height="150" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="8"/>
    <text x="125" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#1565c0">
      Phase 1: Initial Response
    </text>
    
    <!-- Witness nodes in this phase -->
    <g transform="translate(30, 50)">
      <circle cx="0" cy="0" r="15" fill="#4caf50" stroke="#2e7d32" stroke-width="2"/>
      <text x="0" y="5" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">W1</text>
      <text x="0" y="25" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#424242">Valid</text>
      <text x="0" y="35" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#424242">305ns</text>
    </g>
    
    <g transform="translate(95, 50)">
      <circle cx="0" cy="0" r="15" fill="#4caf50" stroke="#2e7d32" stroke-width="2"/>
      <text x="0" y="5" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">W2</text>
      <text x="0" y="25" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#424242">Valid</text>
      <text x="0" y="35" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#424242">608ns</text>
    </g>
    
    <g transform="translate(160, 50)">
      <circle cx="0" cy="0" r="15" fill="#f44336" stroke="#c62828" stroke-width="2"/>
      <text x="0" y="5" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">W3</text>
      <text x="0" y="25" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#424242">Invalid</text>
      <text x="0" y="35" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#424242">200ns</text>
    </g>
    
    <g transform="translate(225, 50)">
      <circle cx="0" cy="0" r="15" fill="#4caf50" stroke="#2e7d32" stroke-width="2"/>
      <text x="0" y="5" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">W4</text>
      <text x="0" y="25" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#424242">Valid</text>
      <text x="0" y="35" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#424242">420ns</text>
    </g>
    
    <text x="125" y="100" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#424242">
      Each witness independently
    </text>
    <text x="125" y="115" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#424242">
      validates signal timing
    </text>
    <text x="125" y="135" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#1976d2">
      Result: 3/4 Valid, 1/4 Invalid
    </text>
  </g>
  
  <!-- Phase 2: Cross-Witness Correlation -->
  <g transform="translate(400, 100)">
    <rect x="0" y="0" width="250" height="150" fill="#fff3e0" stroke="#f57800" stroke-width="2" rx="8"/>
    <text x="125" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#ef6c00">
      Phase 2: Cross-Correlation
    </text>
    
    <!-- Correlation matrix visualization -->
    <g transform="translate(50, 45)">
      <rect x="0" y="0" width="150" height="80" fill="#ffffff" stroke="#f57800" stroke-width="1" rx="3"/>
      <text x="75" y="15" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#ef6c00">
        Correlation Matrix
      </text>
      
      <!-- Grid -->
      <g stroke="#e0e0e0" stroke-width="1">
        <line x1="20" y1="25" x2="130" y2="25"/>
        <line x1="20" y1="40" x2="130" y2="40"/>
        <line x1="20" y1="55" x2="130" y2="55"/>
        <line x1="20" y1="70" x2="130" y2="70"/>
        
        <line x1="20" y1="25" x2="20" y2="70"/>
        <line x1="47" y1="25" x2="47" y2="70"/>
        <line x1="74" y1="25" x2="74" y2="70"/>
        <line x1="101" y1="25" x2="101" y2="70"/>
        <line x1="130" y1="25" x2="130" y2="70"/>
      </g>
      
      <!-- Correlation values -->
      <text x="33" y="37" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#4caf50">0.95</text>
      <text x="60" y="37" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#f44336">0.12</text>
      <text x="87" y="37" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#4caf50">0.88</text>
      
      <text x="33" y="52" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#f44336">0.18</text>
      <text x="60" y="52" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#4caf50">0.92</text>
      <text x="87" y="52" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#f44336">0.15</text>
      
      <text x="33" y="67" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#4caf50">0.93</text>
      <text x="60" y="67" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#f44336">0.08</text>
      <text x="87" y="67" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#4caf50">0.91</text>
    </g>
    
    <text x="125" y="135" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#ef6c00">
      W3 shows anomalous correlation
    </text>
  </g>
  
  <!-- Phase 3: Consensus Formation -->
  <g transform="translate(700, 100)">
    <rect x="0" y="0" width="250" height="150" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="8"/>
    <text x="125" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#6a1b9a">
      Phase 3: Consensus
    </text>
    
    <!-- Voting visualization -->
    <g transform="translate(30, 50)">
      <text x="95" y="0" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#6a1b9a">
        Byzantine Vote
      </text>
      
      <!-- Vote boxes -->
      <rect x="10" y="10" width="40" height="25" fill="#4caf50" stroke="#2e7d32" stroke-width="2" rx="3"/>
      <text x="30" y="27" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">W1</text>
      <text x="30" y="45" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2e7d32">ACCEPT</text>
      
      <rect x="60" y="10" width="40" height="25" fill="#4caf50" stroke="#2e7d32" stroke-width="2" rx="3"/>
      <text x="80" y="27" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">W2</text>
      <text x="80" y="45" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2e7d32">ACCEPT</text>
      
      <rect x="110" y="10" width="40" height="25" fill="#f44336" stroke="#c62828" stroke-width="2" rx="3"/>
      <text x="130" y="27" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">W3</text>
      <text x="130" y="45" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#c62828">REJECT</text>
      
      <rect x="160" y="10" width="40" height="25" fill="#4caf50" stroke="#2e7d32" stroke-width="2" rx="3"/>
      <text x="180" y="27" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">W4</text>
      <text x="180" y="45" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2e7d32">ACCEPT</text>
    </g>
    
    <text x="125" y="115" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#424242">
      Super-majority: 3/4 ≥ 2/3
    </text>
    <text x="125" y="135" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#4caf50">
      CONSENSUS: ACCEPT
    </text>
  </g>
  
  <!-- Phase 4: Final Validation -->
  <g transform="translate(250, 300)">
    <rect x="0" y="0" width="350" height="120" fill="#e8f5e8" stroke="#4caf50" stroke-width="3" rx="8"/>
    <text x="175" y="25" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#2e7d32">
      Phase 4: Final Validation Certificate
    </text>
    
    <g transform="translate(20, 40)">
      <text x="0" y="0" font-family="Arial, sans-serif" font-size="11" fill="#424242">✓ Timestamp: 2025-09-04 15:32:07.123456789 UTC</text>
      <text x="0" y="18" font-family="Arial, sans-serif" font-size="11" fill="#424242">✓ Event Location: (40.7589, -73.9851) ±0.5m</text>
      <text x="0" y="36" font-family="Arial, sans-serif" font-size="11" fill="#424242">✓ Witness Consensus: 3/4 nodes (75% agreement)</text>
      <text x="0" y="54" font-family="Arial, sans-serif" font-size="11" fill="#424242">✓ Physics Validation: PASS (all valid times ≥ t_min)</text>
      <text x="0" y="72" font-family="Arial, sans-serif" font-size="11" fill="#424242">✓ Digital Signature: CRYSTALS-Dilithium verified</text>
    </g>
  </g>
  
  <!-- Attack Detection Box -->
  <g transform="translate(650, 300)">
    <rect x="0" y="0" width="300" height="120" fill="#ffebee" stroke="#f44336" stroke-width="2" rx="8"/>
    <text x="150" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#c62828">
      Attack Detection & Response
    </text>
    
    <g transform="translate(20, 40)">
      <text x="0" y="0" font-family="Arial, sans-serif" font-size="11" fill="#424242">⚠ Anomaly Detected: Witness W3</text>
      <text x="0" y="18" font-family="Arial, sans-serif" font-size="11" fill="#424242">• Signal arrival violated physics (200ns &lt; 250ns)</text>
      <text x="0" y="36" font-family="Arial, sans-serif" font-size="11" fill="#424242">• Low correlation with other witnesses</text>
      <text x="0" y="54" font-family="Arial, sans-serif" font-size="11" fill="#424242">• Node flagged for investigation</text>
      <text x="0" y="72" font-family="Arial, sans-serif" font-size="11" fill="#424242">• Security team notified automatically</text>
    </g>
  </g>
  
  <!-- Flow Arrows -->
  <g stroke="#666666" stroke-width="2" fill="none" marker-end="url(#arrowhead)">
    <defs>
      <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="#666666"/>
      </marker>
    </defs>
    
    <!-- Phase 1 to 2 -->
    <path d="M 350 175 Q 375 175 400 175"/>
    
    <!-- Phase 2 to 3 -->
    <path d="M 650 175 Q 675 175 700 175"/>
    
    <!-- Phase 3 to 4 -->
    <path d="M 825 250 Q 825 275 600 300"/>
    
    <!-- Attack detection connection -->
    <path d="M 825 250 Q 850 275 800 300"/>
  </g>
  
  <!-- Fault Tolerance Stats -->
  <g transform="translate(100, 500)">
    <rect x="0" y="0" width="400" height="180" fill="#fff8e1" stroke="#ffa000" stroke-width="2" rx="8"/>
    <text x="200" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#f57c00">
      Byzantine Fault Tolerance Guarantees
    </text>
    
    <g transform="translate(20, 40)">
      <text x="0" y="0" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#f57c00">Security Properties:</text>
      <text x="0" y="20" font-family="Arial, sans-serif" font-size="11" fill="#424242">• Tolerates up to 33% compromised witnesses</text>
      <text x="0" y="38" font-family="Arial, sans-serif" font-size="11" fill="#424242">• Requires 2/3 + 1 honest nodes for consensus</text>
      <text x="0" y="56" font-family="Arial, sans-serif" font-size="11" fill="#424242">• Detects timing manipulation attacks</text>
      <text x="0" y="74" font-family="Arial, sans-serif" font-size="11" fill="#424242">• Identifies compromised witness behavior</text>
      
      <text x="0" y="105" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#f57c00">Network Resilience:</text>
      <text x="0" y="125" font-family="Arial, sans-serif" font-size="11" fill="#424242">• Automatic node isolation and recovery</text>
      <text x="0" y="143" font-family="Arial, sans-serif" font-size="11" fill="#424242">• Dynamic topology reconfiguration</text>
      <text x="0" y="161" font-family="Arial, sans-serif" font-size="11" fill="#424242">• Self-healing consensus protocols</text>
    </g>
  </g>
  
  <!-- Quantum Resistance -->
  <g transform="translate(550, 500)">
    <rect x="0" y="0" width="400" height="180" fill="#f1f8e9" stroke="#689f38" stroke-width="2" rx="8"/>
    <text x="200" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#558b2f">
      Quantum-Resistant Security Features
    </text>
    
    <g transform="translate(20, 40)">
      <text x="0" y="0" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#558b2f">Post-Quantum Cryptography:</text>
      <text x="0" y="20" font-family="Arial, sans-serif" font-size="11" fill="#424242">• CRYSTALS-Kyber key encapsulation</text>
      <text x="0" y="38" font-family="Arial, sans-serif" font-size="11" fill="#424242">• CRYSTALS-Dilithium digital signatures</text>
      <text x="0" y="56" font-family="Arial, sans-serif" font-size="11" fill="#424242">• SPHINCS+ stateless signatures</text>
      <text x="0" y="74" font-family="Arial, sans-serif" font-size="11" fill="#424242">• Quantum key distribution ready</text>
      
      <text x="0" y="105" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#558b2f">Future-Proof Design:</text>
      <text x="0" y="125" font-family="Arial, sans-serif" font-size="11" fill="#424242">• 256-bit equivalent quantum security</text>
      <text x="0" y="143" font-family="Arial, sans-serif" font-size="11" fill="#424242">• Crypto-agility for algorithm updates</text>
      <text x="0" y="161" font-family="Arial, sans-serif" font-size="11" fill="#424242">• Long-term signature validity</text>
    </g>
  </g>
  
  <!-- Consensus Timeline -->
  <g transform="translate(100, 720)">
    <text x="0" y="0" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#424242">
      Consensus Timeline: Phase 1 (0-50ms) → Phase 2 (50-100ms) → Phase 3 (100-150ms) → Phase 4 (150-200ms)
    </text>
    <line x1="0" y1="10" x2="800" y2="10" stroke="#424242" stroke-width="2"/>
    <circle cx="0" cy="10" r="3" fill="#1976d2"/>
    <circle cx="200" cy="10" r="3" fill="#f57800"/>
    <circle cx="400" cy="10" r="3" fill="#7b1fa2"/>
    <circle cx="600" cy="10" r="3" fill="#4caf50"/>
  </g>
</svg>